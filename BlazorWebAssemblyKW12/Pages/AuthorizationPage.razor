@page "/AuthorizationPage"
@using ShopClient
@using Microsoft.AspNetCore.Components
@using Glory.Domain

@inject ClientDTO _client;

<h3>Authorization</h3>

<EditForm Model="_addFormModel" OnValidSubmit="AuthorizeValidAccount">
    <DataAnnotationsValidator/>
    <ValidationSummary/>
    
    Почта: <InputText @bind-Value="_addFormModel.Email"></InputText><br/>
    Пароль: <InputText @bind-Value="_addFormModel.Password"></InputText><br/>
    <br/>
    <select @bind="Role">
        <option>user</option>
        <option>admin</option>
    </select>
    <br/>
    <input type="submit" value="Войти"/>
</EditForm>
@if (_account != null && _account.Name != "")
{
    <p>Hi, @_account?.Name!</p>
}
else if (_isPushed)
{
    <p>Error 401: Unauthorized</p>
}


@code {
    private readonly AccountRequestDTO _addFormModel = new();
    private AccountDTO? _account;
    private bool _isPushed = false;
    private string? Role { get; set; }

    private async Task AuthorizeValidAccount()
    {
        _account = await _client.Authorize(
            new AccountRequestDTO(
                _addFormModel.Name,
                _addFormModel.Email,
                _addFormModel.Password), Role);
        _isPushed = true;
    }

}